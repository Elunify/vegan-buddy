<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>MainPage</title>
  <link rel="stylesheet" href="homepagestyle.css" />
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>  
</head>
<body>
  <div id="loadingOverlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:9999;">
  <p style="text-align:center; margin-top:50vh;">Loading...</p>
  </div>

<div id="homepageContent" style="opacity:0;">
  <!-- All homepage content here -->

<div id="main-container">
    <!-- ğŸ  Home Content -->
  <div id="home" class="page">  <!-- ğŸ” Top Tabs -->

    <div class="top-bar">
      <div class="top-bar-row">

        <!-- Profile -->
        <div class="profile-wrapper">
          <img id="profilePhoto" src="" alt="Profile Photo" class="profile-photo" />
          <div id="petDisplay" class="pet-overlay"></div>
        </div>

        <!-- Level + Streak -->
        <div class="center-counters">
          <span class="counter">ğŸŒ <span id="currentLevel">0</span></span>
          <span class="counter" id="streak">
            <span class="fire">ğŸ”¥</span> 
            <span id="streak-counter">0</span>
          </span>
        </div>

        <!-- Side Menu -->
        <div id="menuButton" class="menu-button">â˜°</div>
        <div id="sideMenu" class="side-menu">
          <button class="menu-item" id="helpusgrowBtn">Help Us Grow</button>
          <button class="menu-item" id="aboutUsBtn">About Us</button>
          <button onclick="showSection('sources')" class="menu-item" id="sourcesBtn">Sources</button>
        </div>
      </div>

      <!-- XP Progress -->
      <div class="level-bar">
        <div class="progress">
          <div id="levelProgress" class="progress-fill"></div>
        </div>
        <small id="xpToNext"> </small>
      </div>
    </div>
    <!-- End Top Tabs -->


      <div class="top-buttons-wrapper">
        <div class="top-buttons">
        <button id="checkinBtn" class="checkin-btn"><span class="btn-text">Daily Check-in</span></button>
        <button id="healthBtn" class="health-btn hidden"><span class="btn-text">Health Solutions</span></button>
      </div>

  <!-- Column of quick access buttons -->
      <div class="quick-access">
        <button id="lessonsBtn" class="quick-btn">ğŸ“š</button>
        <button id="recipesBtn" class="quick-btn">ğŸ“ƒ</button>
      </div>
    </div>

<div class = impact-box>
  <p><span class="you">You, </span>and our <span class="community">Community</span> <br>
  
<div class="impact-cards">
  
  <!-- Animals -->
  <div class="card">
    ğŸ¾
    <p> saved <br>
       <strong id="youAnimals">12</strong> 
       <strong id="communityAnimals">3560</strong> </p>
    <p>animals</p>
  </div>

  <!-- Forest -->
  <div class="card">
    ğŸŒ²
    <p> saved <br>
       <strong id="youForest">12</strong> 
       <strong id="communityForest">3560</strong> </p>
    <p> mÂ² of forests</p>
  </div>

  <!-- Water -->
  <div class="card">
    ğŸ’§
    <p> saved <br>
       <strong id="youWater">12</strong> 
       <strong id="communityWater">3560</strong> </p>
    <p>L of water</p>
  </div>

  <!-- COâ‚‚ -->
  <div class="card">
    ğŸŒ¬ï¸
    <p> reduced <br>
       <strong id="youCO2">12</strong> 
       <strong id="communityCO2">3560</strong> </p>
    <p>kg of COâ‚‚</p>
  </div>
 </div>
</div>

      <!-- Meal-Art Contest -->
      <div class="meal-art-winners">
        <h3>ğŸ½ï¸ <span class="mealartBtn">Meal-Art</span> Winners This Week:</h3>
        <div class="meal-art-categories">

          <!-- Amateur -->
          <div class="meal-art-card">
            <h4>ğŸ¥• Home Chef</h4>
            <p class="winner-name" id="amateurName">Jane Doe</p>
            <img id="amateurImage" src="meals/amateur.jpg" alt="Amateur winning dish" class="meal-art-image">
            <div id="amateurRecipe"><span class="recipe">Recipe available</span></div>
          </div>

          <!-- Professional -->
          <div class="meal-art-card">
            <h4>ğŸ´ Pro Kitchen</h4>
            <p class="winner-name" id="proName">Green Leaf Bistro</p>
            <img id="proImage" src="meals/professional.jpg" alt="Professional winning dish" class="meal-art-image">
            <div id="professionalRecipe"><span class="no-recipe">Recipe unavailable</span></div>
          </div>
        </div>
      </div>
  </div>  
<!-- End Home Page-->
 <!-- End Home Page-->
  <!-- End Home Page-->
   <!-- End Home Page-->
    <!-- End Home Page-->

    <!-- Top Bar -->
     <!-- Top Bar -->
      <!-- Top Bar -->
       <!-- Top Bar -->
<!-- settings -->   
 <!-- settings -->   
  <!-- settings -->   
   <!-- settings -->        
<div id="settings" class="page hidden" style="margin-top: env(safe-area-inset-top, 30px); margin-bottom: env(50px+safe-area-inset-bottom, 80px);"> 
  <div class="containersettings active">
    <h1 class="settingsh1">My Profile</h1>

    <div class="profile-sectionsettings">
        <img id="profilePhotoprofile" class="profile-photosettings" src="blankphoto.jpg" alt="Profile Photo">
        <div class="profile-infosettings">
            <div class="info-itemsettings"><strong>Name:</strong> <br><span id="profileName">-</span></div>
            <div class="info-itemsettings"><strong>Diet:</strong><br> <span id="diet">-</span></div>
        </div>
    </div>

<div class="profile-counterssettings">
  <span class="countersettings">ğŸŒ <span id="currentLevelprofile">0</span></span>
  <span class="countersettings">ğŸ”¥ <span id="streak-counterprofile">0</span></span>
  <span class="countersettings">ğŸ… <span id="badgeprofile">0</span></span>
</div>

    <div class="section-titlesettings">Goals</div>
<ul id="goalsList" class="details-listsettings"></ul>

<div class="section-titlesettings">Health Issues</div>
<ul id="healthIssuesList" class="details-listsettings"></ul>

    <div class="profile-sectionsettings">
        <img id="petPhotoprofile" class="pet-photosettings" src="defaultPet.jpg" alt="Pet Photo">
        <div class="profile-infosettings">
            <div class="info-item"><strong>Pet Name:</strong> <br><span id="petNameprofile">-</span></div>
        </div>
    </div>
    <a href="#" class="editprofile"> <button>Edit profile</button></a>
  </div>

  <div class="containeredit hidden">
    <h1 class="settingsh1">Edit My Profile</h1>

    <!-- Profile Info -->
      <div class="profile-sectionsettings">
        <img id="profilePhotoPreview" class="profile-photosettings" src="blankphoto.jpg" alt="Profile Photo">
        <input type="text-hidden" id="profilePhotoInput">

        <div class="profile-infoedit">
          <div class="info-itemsettings">
        <label for="profileNameInput"><strong>Name:</strong></label>
        <input type="text" id="profileNameInput" placeholder="Enter your name">
        </div>
          <div class="info-itemsettings">

        <label for="profileDietSelect"><strong>Diet:</strong></label>
  <select id="profileDietSelect">
    <option value="vegan">Vegan</option>
    <option value="intransition">In Transition</option>
    <option value="vegetarian">Vegetarian</option>
    <option value="pescatarian">Pescatarian</option>
    <option value="Flexitarian">Flexitarian</option>
    <option value="omnivore">Omnivore</option>
  </select>
          </div>
        </div>
      </div>

          <div class="changebtn">
            <input type="file" id="profilePhotoUpload" accept="image/*" style="display: none;">
            <button class="button" id="changeProfilePhotoBtn">Change Profile Photo</button>
          </div>

      <!-- Lists -->
      <!-- Q2: Goals -->
<div class="question" id="q2">
  <div class="section-titleedit">Goals:</div>

  <label class="checkbox-label">
    <input type="checkbox" name="goal" value="Protecting animals & animal welfare">
    Protecting animals
  </label>
<br>
  <label class="checkbox-label">
    <input type="checkbox" name="goal" value="Caring for the environment & fighting climate change">
    Caring for the environment
  </label>
<br>
  <label class="checkbox-label">
    <input type="checkbox" name="goal" value="Healthy living & wellness">
    Healthy living
  </label> 
<br>
  <label class="checkbox-label">
    <input type="checkbox" name="goal" value="Solving health issues">
    Solving health issues
  </label> 
<br>
  <label class="checkbox-label">
    <input type="checkbox" name="goal" value="Boosting my performance as an athlete">
    Boosting my performance as an athlete
  </label>
</div>

<!-- Q2b: Health Issues (shown only if "Solving health issues" is checked) -->
<div class="question" id="q2b">
  <div class="section-titleedit">Health Issues:</div>

  <label class="checkbox-label">
    <input type="checkbox" name="healthIssue" value="Heart disease">
    Heart disease
  </label>
<br>
  <label class="checkbox-label">
    <input type="checkbox" name="healthIssue" value="High cholesterol">
    High cholesterol
  </label>
<br>
  <label class="checkbox-label">
    <input type="checkbox" name="healthIssue" value="High blood pressure">
    High blood pressure
  </label>
<br>
  <label class="checkbox-label">
    <input type="checkbox" name="healthIssue" value="Type 2 diabetes">
    Type 2 diabetes
  </label>
<br>
  <label class="checkbox-label">
    <input type="checkbox" name="healthIssue" value="Obesity">
    Obesity
  </label>
<br>
  <label class="checkbox-label">
    <input type="checkbox" name="healthIssue" value="Digestive issues">
    Digestive issues
  </label>
<br>
  <label class="checkbox-label">
    <input type="checkbox" name="healthIssue" value="Inflammation or swelling">
    Inflammation or swelling
  </label>
<br>
  <label class="checkbox-label">
    <input type="checkbox" name="healthIssue" value="Fatigue">
    Fatigue
  </label>
<br>
  <label class="checkbox-label">
    <input type="checkbox" name="healthIssue" value="Cancer risk">
    Concerned about cancer risk
  </label>
</div>


      <!-- Pet Info -->
      <div class="profile-sectionsettings"><br>
        <img id="petPhotoPreview" class="pet-photosettings" src="defaultPet.jpg" alt="Pet Photo"> 
        <input type="text-hidden" id="petPhotoInput">
        <div class="profile-infoedit">
          <div class="info-itemsettings">
        <label for="petNameInput"><strong>Pet Name:</strong></label>
        <input type="text" id="petNameInput" placeholder="Enter pet name">
        </div>
          <div class="info-itemsettings">
            <input type="file" id="petPhotoUpload" accept="image/*" style="display: none;">
            <button class="button" id="changePetPhotoBtn">Change Pet Photo</button>
          </div>
        </div>
      </div>

      <div style="text-align:center; margin:1rem 0;">
        <button class="button" id="saveBtn">ğŸ’¾ Save Profile</button>
      </div> 
  </div>
</div>

<!-- SupportUs -->   
 <!-- SupportUs -->   
  <!-- SupportUs -->   
   <!-- SupportUs -->   
<div id="supportus" class="page hidden" style="margin-top: env(safe-area-inset-top, 30px); margin-bottom: env(50px+safe-area-inset-bottom, 80px);"> 

  <div class="explanationsupportus">
    <div class="message-section">
      <div class="buddy-messagesupportus">
        <img src="characters/eluna.png" alt="Eluna" class="buddy-portraitsupportus" />
        <div class="buddy-text">
          <strong style="font-size: 1.1em; line-height: 1.3rem;">Eluna says:</strong><br> 
          We believe in full transparency. Every euro you donate goes directly to projects that make a real difference for animals, people, and the planet. 
          Our organisation is non-profit, and every cent is used for impact â€” not profit. To keep you connected, we share regular videos on 
          <a href="https://www.instagram.com/app.elunify/" target="_blank" rel="noopener noreferrer">Instagram</a>
          showing exactly where your donations go. Together, we can grow something bigger than ourselves.
        </div>
      </div>
    </div>
  </div>

  <div class="optionssupportus">
    <div class="optionsupportus donate">
      <h3>Donate</h3>
      <p>
        Your donation makes a direct impact. Whether big or small, every contribution helps us grow. 
        As a thank-you, youâ€™ll receive XP and badges inside the app, and the top donors will be honored in our leaderboards.
      </p>
      <button class="button" id="donatebtn" onclick="window.location.href='donation.html'">Donate Now</button>
    </div>

    <div class="optionsupportus support">
      <h3>Support Us</h3>
      <p>
        Want to help but canâ€™t donate right now? You can still support us! By watching a short ad, you generate funds that we will use for the same projects. 
        As a thank-you, youâ€™ll also earn XP and badges â€” because every action matters.
      </p>
      <button class="button" id="adbtn" onclick="watchAd()">Watch an Ad</button>
    </div>


    <div class="optionsupportus membershipssupportus">
  <h3>Memberships</h3>
  <p>
    Want to support us long-term and unlock extra rewards? Become a member! Youâ€™ll get XP boosts, badges, and special recognition. 
  </p>
  <button class="button" id="memberbtn" onclick="toggleMemberships()">View Memberships</button>

  <div id="membership-list" style="display:none; margin-top:15px;">
    <h4>ğŸŒŸ Membership Tiers</h4>
    <div class="membership-cardssupportus">

      <div class="membership-cardsupportus">
        <h5>Seed Member ğŸŒ±</h5>
        <p>â‚¬2 / month</p>
        <ul>
          <li>+5% XP boost on all activities & badges for donations</li>
          <li>Seed badge in profile</li>
        </ul>
      </div>

      <div class="membership-cardsupportus">
        <h5>Sprout Member ğŸŒ¿</h5>
        <p>â‚¬5 / month</p>
        <ul>
          <li>+10% XP boost</li>
          <li>Exclusive badge</li>
        </ul>
      </div>

      <div class="membership-cardsupportus">
        <h5>Tree Member ğŸŒ³</h5>
        <p>â‚¬10 / month</p>
        <ul>
          <li>+20% XP boost</li>
          <li>Early access to new features</li>
          <li>Name in donor videos</li>
        </ul>
      </div>

      <div class="membership-cardsupportus">
        <h5>Forest Member ğŸŒ²</h5>
        <p>â‚¬20 / month</p>
        <ul>
          <li>+40% XP boost</li>
          <li>Highlighted spot on leaderboard</li>
          <li>Special recognition badge</li>
        </ul>
      </div>

      <div class="membership-cardsupportus">
        <h5>Earth Guardian Member ğŸŒ</h5>
        <p>â‚¬50 / month</p>
        <ul>
          <li>+100% XP boost</li>
          <li>Personal shoutout in videos</li>
          <li>VIP badge & profile highlight</li>
        </ul>
      </div>

    </div>
  </div>
</div>
</div>


</div>
<!-- AboutUs --> 
 <!-- AboutUs --> 
  <!-- AboutUs --> 
   <!-- AboutUs -->   
    <div id="aboutus" class="page hidden" style="margin-top: env(safe-area-inset-top, 30px); margin-bottom: env(50px+safe-area-inset-bottom, 80px);"> 
      <div class="optionssupportus">
      <div class="optionaboutus">
      <h3>About us</h3>
      <p>
        We are a small, heart-driven initiative with one clear goal: to make a difference for animals, people, and the planet. 
        This project is not backed by big companies â€” itâ€™s personal, transparent, and honest. 
        Right now, itâ€™s just me working on it, but together with you, we can build a community that cares.
        By using this app, supporting, or even just being here, you are part of something that creates real-world impact. 
        We dream of a future where compassion grows stronger every day â€” and you are part of that story.
      </p>
     </div>
    </div>
  </div>
<!-- Sources -->
 <!-- Sources -->
  <!-- Sources -->
   <!-- Sources -->
    <div id="sources" class="page hidden" style="margin-top: env(safe-area-inset-top, 30px); margin-bottom: env(50px+safe-area-inset-bottom, 80px);"> 
      ...Sources content... 
    
    
    
    
    
    
    </div>
<!-- Main features -->   
 <!-- Main features -->   
  <!-- Main features -->   
   <!-- Main features -->   
  
<!-- Daily Check-in -->
 <!-- Daily Check-in -->
  <!-- Daily Check-in -->
   <!-- Daily Check-in -->
    <div id="dailycheck-in" class="page hidden" style="margin-top: env(safe-area-inset-top, 30px); margin-bottom: env(50px+safe-area-inset-bottom, 80px);"> 
      
    
        <div id="quizDCI" class="boxDCI">
            <!-- JS will insert yesterday's quiz here -->
        </div>

        <div id="lessonsectionDCI" class="boxDCI">
          <label class = "bigLabelDCI">Your lesson for today:</label>
          <div id="dailyLessonDCI" class="lesson-boxDCI">
          <!-- JS will insert today's lesson here -->
          </div>
        </div>
    
        <div id="mealsectionDCI" class="boxDCI">
          <label class = "bigLabelDCI">How many plant-based meal did you have yesterday?</label>
        
          <label class="checkbox-labelDCI"><input type="radio" name="mealsDCI" value="1">I didnâ€™t have a plant-based meal.</label>
          <label class="checkbox-labelDCI"><input type="radio" name="mealsDCI" value="2">I had a few plant-based meals! </label>
          <label class="checkbox-labelDCI"><input type="radio" name="mealsDCI" value="3">Most of my meals were plant-based!</label>
          <label class="checkbox-labelDCI"><input type="radio" name="mealsDCI" value="4">I had a fully plant-based day! ğŸŒ±</label>

        </div>
    
        <button class="button" id="submitBtnDCI" onclick="handleSubmit()">Submit</button>
    
    </div>

<!-- Health Issues -->
 <!-- Health Issues -->
  <!-- Health Issues -->
   <!-- Health Issues -->
  <div id="healthissues" class="page hidden" style="margin-top: env(safe-area-inset-top, 30px); margin-bottom: env(50px+safe-area-inset-bottom, 80px);"> 
     
  <h2 class = "YourHealthIssueTitle">Your Health Issues</h2>

  <div class="learning-path-buttons">
    <!-- All possible health issues (initially hidden) -->
    <button class="path-btn hidden" data-path="Heart disease">Heart disease</button>
    <button class="path-btn hidden" data-path="High cholesterol">High cholesterol</button>
    <button class="path-btn hidden" data-path="High blood pressure">High blood pressure</button>
    <button class="path-btn hidden" data-path="Type 2 diabetes">Type 2 diabetes</button>
    <button class="path-btn hidden" data-path="Obesity">Obesity</button>
    <button class="path-btn hidden" data-path="Digestive issues">Digestive issues</button>
    <button class="path-btn hidden" data-path="Inflammation or swelling">Inflammation or swelling</button>
    <button class="path-btn hidden" data-path="Fatigue">Fatigue</button>
    <button class="path-btn hidden" data-path="Cancer risk">Concerned about cancer risk</button>
  </div>

  <!-- Courses / Lessons containers -->
  <div class="courses">
    <!-- one course container per health issue, initially hidden -->
    <div class="course hidden" id="Heart disease"><h3>Heart disease</h3><ul class="lesson-list"></ul></div>
    <div class="course hidden" id="High cholesterol"><h3>High cholesterol</h3><ul class="lesson-list"></ul></div>
    <div class="course hidden" id="High blood pressure"><h3>High blood pressure</h3><ul class="lesson-list"></ul></div>
    <div class="course hidden" id="Type 2 diabetes"><h3>Type 2 diabetes</h3><ul class="lesson-list"></ul></div>
    <div class="course hidden" id="Obesity"><h3>Obesity</h3><ul class="lesson-list"></ul></div>
    <div class="course hidden" id="Digestive issues"><h3>Digestive issues</h3><ul class="lesson-list"></ul></div>
    <div class="course hidden" id="Inflammation or swelling"><h3>Inflammation or swelling</h3><ul class="lesson-list"></ul></div>
    <div class="course hidden" id="Fatigue"><h3>Fatigue</h3><ul class="lesson-list"></ul></div>
    <div class="course hidden" id="Cancer risk"><h3>Concerned about cancer risk</h3><ul class="lesson-list"></ul></div>
  </div>
</div>

<!-- Hidden lesson tab -->
<div id="healthylesson-tab" class="hidden">
  <button id="close-lesson">â¬… Back</button>
  <h2 id="lesson-title"></h2>
  <div id="lesson-content"></div>
  <div id="quiz-container"></div>
</div>
  
<!-- Meal Art Contest -->
 <!-- Meal Art Contest -->
  <!-- Meal Art Contest -->
   <!-- Meal Art Contest -->
    <div id="mealartcontest" class="page hidden" style="margin-top: env(safe-area-inset-top, 30px); margin-bottom: env(50px+safe-area-inset-bottom, 80px);"> 
      ...Meal-Art Contest content... 







    </div>

<!-- Learn subsections -->
 <!-- Learn subsections -->
  <!-- Learn subsections -->
   <!-- Learn subsections -->
    <div id="lessons" class="page hidden" style="margin-top: env(safe-area-inset-top, 30px); margin-bottom: env(50px+safe-area-inset-bottom, 80px);"> 
      
      <div class="learning-path-buttons">
    <button class="path-btn" data-path="animals">For the Animals</button>
    <button class="path-btn" data-path="earth">For the Earth</button>
    <button class="path-btn" data-path="health">For Health</button>
  </div>

  <!-- Courses / Lessons containers -->
<div class="courses">

  <div class="course hidden" id="animals">
    <h3>For the Animals</h3>
    <ul class="extralesson-list"></ul>
  </div>

  <div class="course hidden" id="earth">
    <h3>For the Earth</h3>
    <ul class="extralesson-list"></ul>
  </div>

  <div class="course hidden" id="health">
    <h3>For Health</h3>
    <ul class="extralesson-list"></ul>
  </div>

 </div>
</div>

<!-- Recipes -->
 <!-- Recipes -->
  <!-- Recipes -->
   <!-- Recipes -->
    <div id="recipes" class="page hidden" style="margin-top: env(safe-area-inset-top, 30px); margin-bottom: env(50px+safe-area-inset-bottom, 80px);"> 
      <h2>Community Recipes</h2>
  <div id="recipes-container" class="recipes-container">
    <!-- Recipes will be loaded here dynamically -->
  </div>
  <!-- Upload Recipe Button -->
  <button id="openUploadBtn" class="upload-btn">â• Upload Your Own Recipe</button>
    </div>



    <div id="recommendations" class="page hidden" style="margin-top: env(safe-area-inset-top, 30px); margin-bottom: env(50px+safe-area-inset-bottom, 80px);"> 
      ...Recommendations content... </div>

    <!-- Explore subsections -->
    <div id="restaurants" class="page hidden" style="margin-top: env(safe-area-inset-top, 30px); margin-bottom: env(50px+safe-area-inset-bottom, 80px);"> 
      ...Restaurants Map... </div>
    <div id="scan" class="page hidden" style="margin-top: env(safe-area-inset-top, 30px); margin-bottom: env(50px+safe-area-inset-bottom, 80px);"> 
      ...Scan Products... </div>

    <!-- Community subsections -->
    <div id="local" class="page hidden" style="margin-top: env(safe-area-inset-top, 30px); margin-bottom: env(50px+safe-area-inset-bottom, 80px);"> 
      ...Local Community... </div>
    <div id="events" class="page hidden" style="margin-top: env(safe-area-inset-top, 30px); margin-bottom: env(50px+safe-area-inset-bottom, 80px);"> 
      ...Events... </div>
    <div id="forum" class="page hidden" style="margin-top: env(safe-area-inset-top, 30px); margin-bottom: env(50px+safe-area-inset-bottom, 80px);"> 
      ...Forum... </div>
    <div id="friends" class="page hidden" style="margin-top: env(safe-area-inset-top, 30px); margin-bottom: env(50px+safe-area-inset-bottom, 80px);"> 
      ...Friends... </div>
    <div id="mentorship" class="page hidden" style="margin-top: env(safe-area-inset-top, 30px); margin-bottom: env(50px+safe-area-inset-bottom, 80px);"> 
      ...Mentorship... </div>
    <div id="success" class="page hidden" style="margin-top: env(safe-area-inset-top, 30px); margin-bottom: env(50px+safe-area-inset-bottom, 80px);"> 
      ...Success Stories... </div>

    <!-- Playground subsections -->
    <div id="avatar" class="page hidden" style="margin-top: env(safe-area-inset-top, 30px); margin-bottom: env(50px+safe-area-inset-bottom, 80px);"> 
      ...Your Avatar... </div>
    <div id="shop" class="page hidden" style="margin-top: env(safe-area-inset-top, 30px); margin-bottom: env(50px+safe-area-inset-bottom, 80px);"> 
      ...Shop... </div>
    <div id="leaderboards" class="page hidden" style="margin-top: env(safe-area-inset-top, 30px); margin-bottom: env(50px+safe-area-inset-bottom, 80px);"> 
      ...Leaderboards... </div>
    <div id="challenges" class="page hidden" style="margin-top: env(safe-area-inset-top, 30px); margin-bottom: env(50px+safe-area-inset-bottom, 80px);"> 
      ...Challenges... </div>



    <!-- ğŸ”– Bottom Navigation -->
    <div class="bottom-nav">
      <button onclick="showSection('home')">ğŸ </button>
      <div class="dropdown">
        <button>ğŸ“– </button>
        <div class="dropdown-content">
          <button onclick="showSection('lessons')">Lessons</button>
          <button onclick="showSection('recipes')">Recipes</button>
          <button onclick="showSection('recommendations')">Recommendations</button>
        </div>
      </div>
      <div class="dropdown">
        <button>ğŸ” </button>
        <div class="dropdown-content">
          <button onclick="showSection('restaurants')">Restaurants</button>
          <button onclick="showSection('scan')">Scan Products</button>
        </div>
      </div>
      <div class="dropdown">
        <button>ğŸŒ </button>
        <div class="dropdown-content">
          <button onclick="showSection('local')">Local Community</button>
          <button onclick="showSection('events')">Events</button>
          <button onclick="showSection('forum')">Forum</button>
          <button onclick="showSection('friends')">Friends</button>
          <button onclick="showSection('mentorship')">Mentorship</button>
          <button onclick="showSection('success')">Success Stories</button>
        </div>
      </div>
      <div class="dropdown">
        <button>ğŸ§¸ </button>
        <div class="dropdown-content">
          <button onclick="showSection('avatar')">Your Avatar</button>
          <button onclick="showSection('shop')">Shop</button>
          <button onclick="showSection('leaderboards')">Leaderboards</button>
          <button onclick="showSection('challenges')">Challenges</button>
        </div>
      </div>
    </div>

</div> 
<!-- End main-container -->
 <!-- End main-container -->
  <!-- End main-container -->
   <!-- End main-container -->
    <!-- End main-container -->


<div class="avatar-row" style="display: none;">
    <!-- Eluna -->
<div class="profile-wrapper" onclick="toggleThought('eluna')">
  <img class="avatar" src="characters/eluna.png" alt="Eluna">
  <div class="thought-toggle" >ğŸ’­</div>
  <div id="elunaThought" class="thought-bubble">
    <span>Eluna</span> is thinking...
    <div id="elunaTip" class="lesson-box"></div>
  </div>
</div>

<!-- Elune -->
<div class="profile-wrapper" onclick="toggleThought('elune')">
  <img class="avatar" src="characters/elune.png" alt="Elune">
  <div class="thought-toggle">ğŸ’­</div>
  <div id="eluneThought" class="thought-bubble">
    <span>Elune</span> is thinking...
    <div id="eluneTip" class="lesson-box"></div>
  </div>
</div>

<!-- Pet -->
<div class="profile-wrapper" onclick="toggleThought('pet')">
  <div class="avatar" id="petAvatar"></div><!-- Will be replaced by image -->
  <div class="thought-toggle">ğŸ’­</div>
  <div id="petThought" class="thought-bubble">
    <span id="petName">Pet</span> is thinking...
    <div id="petTip" class="lesson-box"></div>
  </div>
</div>
</div>
<!-- End homepageContent -->
 <!-- End homepageContent -->
  <!-- End homepageContent -->
   <!-- End homepageContent -->
    <!-- End homepageContent -->

<!-- POPUPS -->
 <!-- POPUPS -->
  <!-- POPUPS -->
   <!-- POPUPS -->
    <!-- POPUPS -->

<!-- Popup: Animals -->
<div id="popupAnimals" class="popup hidden">
  <div class="popup-content">
    <button class="popup-close">âœ–</button>
    <h2>Animals Saved</h2>
    <p>Content goes here...</p>
    <!-- Toggle link -->
    <p>
      <span class="openCalculator" style="color:blue; cursor:pointer; text-decoration:underline;">
        Use our impact calculator
      </span>
    </p>
  </div>
</div>

<!-- Popup: Forest -->
<div id="popupForest" class="popup hidden">
  <div class="popup-content">
    <button class="popup-close">âœ–</button>
    <h2>Forest Saved</h2>
    <p>Content goes here...</p>
    <!-- Toggle link -->
    <p>
      <span class="openCalculator" style="color:blue; cursor:pointer; text-decoration:underline;">
        Use our impact calculator
      </span>
    </p>
  </div>
</div>

<!-- Popup: Water -->
<div id="popupWater" class="popup hidden">
  <div class="popup-content">
    <button class="popup-close">âœ–</button>
    <h2>Water Saved</h2>
    <p>Content goes here...</p>
    <!-- Toggle link -->
    <p>
      <span class="openCalculator" style="color:blue; cursor:pointer; text-decoration:underline;">
        Use our impact calculator
      </span>
    </p>
  </div>
</div>

<!-- Popup: CO2 -->
<div id="popupCO2" class="popup hidden">
  <div class="popup-content">
    <button class="popup-close">âœ–</button>
    <h2>COâ‚‚ Reduced</h2>
    <p>Content goes here...</p>
    <!-- Toggle link -->
    <p>
      <span class="openCalculator" style="color:blue; cursor:pointer; text-decoration:underline;">
        Use our impact calculator
      </span>
    </p>
  </div>
</div>

<!-- Popup: Impact Calculator -->
<div id="impactcalculator" class="popup hidden">
  <div class="popup-content">
    <button class="popup-close">âœ–</button>
    <h2>Impact Calculator</h2>
    <p>Calculator content goes here...</p>
  </div>
</div>

<!-- Popup: Amateur Home Chef -->
<div id="popupAmateur" class="popup hidden">
  <div class="popup-content">
    <button class="popup-close">âœ–</button>
    <img id="amateurImagePopup" src="meals/amateur.jpg" alt="Amateur winning dish" class="meal-art-image">
  </div>
</div>

<!-- Popup: Pro Kitchen -->
<div id="popupProfessional" class="popup hidden">
  <div class="popup-content">
    <button class="popup-close">âœ–</button>
    <img id="proImagePopup" src="meals/professional.jpg" alt="Professional winning dish" class="meal-art-image">
  </div>
</div>

<!-- Recipe Modal -->
<div id="recipeModal" class="popup hidden">
  <div class="popup-content">
    <button id="closeModal" class="popup-close">âœ–</button>
    <h2 id="modalFoodName"></h2>
    <h3>Ingredients</h3>
    <p id="modalIngredients"></p>
    <h3>Instructions</h3>
    <p id="modalInstructions"></p>
  </div>
</div>

<!-- Upload Recipe Modal -->
<div id="upload-recipe" class="modal hidden-modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h2>Upload a New Recipe</h2>
    <form id="recipeForm">
      <label>
        Recipe Image:
        <input type="file" id="recipeImage" accept="image/*" required>
      </label>
      <div id="imagePreview" style="width:150px; height:150px; border:1px solid #ccc; display:none; align-items:center; justify-content:center; overflow:hidden; border-radius:10px; margin:auto; margin-bottom: 0.5rem;">
  <img id="previewImg" style="display:block;width:100%; height:100%; object-fit:cover; margin-bottom: 0.5rem;">
</div>
      <label>
        Title:
        <input type="text" id="recipeTitle" required>
      </label>
      <label>
        Ingredients:
        <textarea id="recipeIngredients" placeholder="List ingredients..." required></textarea>
      </label>
      <label>
        Instructions:
        <textarea id="recipeInstructions" placeholder="Step by step instructions..." required></textarea>
      </label>
      <button type="submit">Upload Recipe</button>
    </form>
    <div id="uploadFeedback" style="margin-top:10px;"></div>
  </div>
</div>
<!-- Recipe Details Modal -->
<div id="recipe-modal" class="hidden-modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <img id="modal-img" src="" alt="" class="modal-img">
    <h2 id="modal-title"></h2>
    <p id="modal-ingredients"></p>
    <p id="modal-instructions"></p>
  </div>
</div>

</div> 

<script type="module" src="scriptpools.js"></script>
<script type="module" src="scriptcalculationandinserts.js"></script>
<script type="module" src="scriptfunctions.js"></script>
<script type="module" src="scriptreads.js"></script>
<script src="scriptbuttons.js"></script>

  <script type="module">
  import { supabase } from "./supabaseClient.js";
  document.addEventListener("DOMContentLoaded", async () => {
  const loadingOverlay = document.getElementById("loadingOverlay");
  const homepageContent = document.getElementById("homepageContent"); // wrap your homepage content

  // Helper: Calculate level from XP
  function getLevelFromXP(totalXP) {
    let level = 1;
    let xpNeededForNext = 100;
    let xpLeft = totalXP;

    while (xpLeft >= xpNeededForNext && level < 100) {
      xpLeft -= xpNeededForNext;
      level++;
      xpNeededForNext = Math.floor(xpNeededForNext * 1.05);
    }

    return { level, xpTowardsNextLevel: xpLeft, xpNeededForNextLevel: xpNeededForNext };
  }

  // Wait for auth and profile
  const { data: { user }, error: authError } = await supabase.auth.getUser();
  if (!user || authError) {
    console.warn("Not logged in or auth error:", authError);
    if (loadingOverlay) loadingOverlay.style.display = "none";
    if (homepageContent) homepageContent.style.opacity = 1;
    return;
  }

  const { data: profile, error: profileError } = await supabase
    .from("profiles")
    .select("*")
    .eq("id", user.id)
    .single();

  if (!profile || profileError) {
    console.error("Profile not found:", profileError);
    if (loadingOverlay) loadingOverlay.style.display = "none";
    if (homepageContent) homepageContent.style.opacity = 1;
    return;
  }

  // Wait for all images on the page
  await Promise.all(Array.from(document.images).map(img => {
    if (img.complete) return Promise.resolve();
    return new Promise(resolve => img.onload = img.onerror = resolve);
  }));

  // Optional delay 
  await new Promise(resolve => setTimeout(resolve, 300)); //1000 = 1 second

  // Update XP progress
  const countersElements = {
    levelBar: document.getElementById('levelProgress'),
    currentLevelEl: document.getElementById("currentLevel"),
  };

  const { level, xpTowardsNextLevel, xpNeededForNextLevel } = getLevelFromXP(profile.total_xp || 0);

  if (countersElements.levelBar) {
    if (level >= 100) {
      countersElements.levelBar.style.display = "none";
    } else {
      countersElements.levelBar.style.display = "block";
      let progressPercent = (xpTowardsNextLevel / xpNeededForNextLevel) * 100;
      progressPercent = Math.min(progressPercent, 100);
      countersElements.levelBar.style.width = progressPercent + '%';
      // countersElements.levelBar.textContent = progressPercent.toFixed(0) + '%'; // optional
      if (countersElements.currentLevelEl) countersElements.currentLevelEl.textContent = level;
    }
  }

  // Show the page
  if (loadingOverlay) loadingOverlay.style.display = "none";
  if (homepageContent) homepageContent.style.opacity = 1;
});
</script>
</body>
</html>