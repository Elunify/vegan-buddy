<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>MainPage</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabaseClient.js"></script>
  <link rel="stylesheet" href="mainpagestyle.css" />
</head>
<body>
 <div id="main-container">

  <div class="top-bar">
    <div class="top-bar-row">
      <!-- Avatar display with pet overlay -->
    <a href="yourprofile.html" class="profile-wrapper">
      <img id="profilePhoto" src="" alt="Profile Photo" class="profile-photo" />
      <div id="petDisplay" class="pet-overlay">
        <!-- Pet emoji or image will appear here via JS -->
      </div>
    </a>

    <div class="center-counters">
      <span class="counter">ğŸŒ <span id="currentLevel">0</span></span>
      <span class="counter">ğŸ”¥ <span id="streak-counter">0</span></span>
    </div>


    <div id="menuButton" class="menu-button">â˜°</div>

      <div id="sideMenu" class="side-menu hidden">
  <button class="menu-item" id="topListsBtn">Leaderboards</button>
  <button class="menu-item" id="helpusgrowBtn">Help Us Grow</button>
  <button class="menu-item" id="aboutUsBtn">About Us</button>
  <button class="menu-item" id="sourcesBtn">Sources</button>
  <button class="menu-item reset" id="resetBtn">Reset Impact</button>
  <button class="menu-item add" id="addBtn">Add Impact</button>
  <button class="menu-item" id="logoutBtn">Log out</button>
</div>
</div>
      <div class="level-bar" id="levelBar">0%</div>

</div><!-- end of top-bar -->


<div class="page">
  <div class="main-content">
    <!-- First row -->
    <div class="top-row">
      <div class="feature-container">
        <div class="feature-tab" id= "daily-checkin-tab" onclick="window.location.href='dailycheckin.html'" style="padding: 0.5rem;">ğŸŒ± Daily Check-in</div>
        <div class="feature-tab"><div class ="feature locked" id="meal-plans" data-unlock = "ğŸ”“ S2 / L2" onclick="window.location.href='mealplans.html'">ğŸ“ƒ Meal Plans</div></div>
        <div class="feature-tab"><div class ="feature locked" id="Scan & Info" data-unlock = "ğŸ”“ S10 / L5" onclick="window.location.href='scanandinfo.html'">ğŸ” Discover</div></div>
        <div class="feature-tab"><div class ="feature locked" id="Community" data-unlock = "ğŸ”“ S15 / L6" onclick="window.location.href='community.html'">ğŸŒ Community</div></div>
        <div class="feature-tab"><div class ="feature locked" id="Playground" data-unlock = "ğŸ”“ S20 / L7" onclick="window.location.href='playground.html'">ğŸ§¸ Playground</div></div>
      </div>

      <a href="yourimpact.html" class="impact-link">
  <div class="impact">
    <div class="impact-column">
      <span class="impact-item">ğŸ¾ <span id="savedAnimals">0</span></span> 
      <span class="impact-item">ğŸŒ² <span id="savedForest">0</span> mÂ²</span> 
      <span class="impact-item">ğŸ’§ <span id="savedWater">0</span> L</span> 
      <span class="impact-item">ğŸŒ¬ï¸ <span id="savedCO2">0</span> kg</span> 
      <span class="impact-item">ğŸ¤ <span id="savedDonated">0</span> â‚¬</span> 
    </div>
  </div>
</a>
    </div>

    <!-- Second row -->
    <div class="bottom-row">
  <a href="extrastudy.html" class="message-section">
    <div class="buddy-message">
      <img src="characters/eluna.png" alt="Eluna" class="buddy-portrait" />
      <div class="buddy-text">
        <strong>Eluna asks:</strong><br />
        ğŸ’¡ â€œWant to learn more?
      </div>
    </div>
  </a>
  <div class = "mindfulness">
  <div class ="feature locked" id="Mindful vegan" data-unlock = "ğŸ”“ View Streak 30 / Lvl 10">
      <a href="mindfulvegan.html" class="mindful-section">
        <div class="mindful-text">
          Kindred Circle
        </div>
      </a></div></div>
    </div>
  </div>


<!-- Meal-Art Winners Section -->
<div class="meal-art-winners">
   <div class ="feature-tab" id="meal-art">
  <h3 class="meal-art-title">ğŸ½ï¸ Meal-Art winners this week:</h3>
  
  <div class="meal-art-categories">
    <!-- Amatour / Hobby category -->
    <div class="meal-art-card">
      <h4> ğŸ¥• Home Chef </h4>
      <p class="winner-name" id="amateurName"> Jane Doe</p>
      <img id="amateurImage" src="meals/amateur.jpg" alt="Amateur winning dish" class="meal-art-image">
      <div class="meal-art-recipe" id="amateurRecipe">
  <a href="amateurRecipe.html">Recipe available</a>
</div>
    </div>

    <!-- Professional / Restaurant category -->
    <div class="meal-art-card">
      <h4>ğŸ´ Pro Kitchen </h4>
      <p class="winner-name" id="proName">Green Leaf Bistro</p>
      <img id="proImage" src="meals/professional.jpg" alt="Professional winning dish" class="meal-art-image">
      <div class="meal-art-recipe" id="professionalRecipe">
  <span class="no-recipe">Recipe unavailable</span>
</div>
    </div>
  </div>

  <!-- Recipe Modal -->
<div id="recipeModal" class="modal" style="display:none;">
  <div class="modal-content">
    <span id="closeModal" class="close">&times;</span>
    <h3 id="modalFoodName"></h3>
    <h4>Ingredients:</h4>
    <p id="modalIngredients"></p>
    <h4>Instructions:</h4>
    <p id="modalInstructions"></p>
  </div>
</div>

</div>
</div>
</div>
  


  <div id="avatarDisplayPet" class="profile-wrapperPet"><div id="petMessage">
  <div id="petAvatar" class="pet-avatar">
    <!-- Pet emoji or photo will be injected here via JS -->
  </div>
  <div id="thoughtToggle" class="thought-toggle">ğŸ’­</div>
</div>
  <!-- Hidden bubble -->
  <div id="petThought" class="pet-bubble hidden">
    <span id="pet_name"></span> is thinking...
    <div id="dailyTip" class="lesson-box">
      <!-- Lesson of the day will appear here -->
    </div>
  </div>
</div>



<div class="impact-bottom-wrapper">
    <h3 class="impact-bottom-title">Our community's impact:</h3>
    <div class="impact-row">
      <div class="impact-item">ğŸ¾ <span id="animalsSavedBottom">0</span></div>
      <div class="impact-item">ğŸŒ² <span id="forestSavedBottom">0</span> mÂ²</div>
      <div class="impact-item">ğŸ’§ <span id="waterSavedBottom">0</span> L</div>
      <div class="impact-item">ğŸŒ¬ï¸ <span id="co2SavedBottom">0</span> kg</div>
      <div class="impact-item">ğŸ¤ <span id="donatedBottom">0</span> â‚¬</div>
    </div>
  </div>
 <!-- end of mainPage -->
</div>







<!-- Onboarding overlay -->
<div id="intro-overlay">
<div id="introwindow">
<img id="petPhotoDisplay" class="pet-img" />
  <div id="introbubble" class="step-1">
    <!-- Step 1 -->
    <div class="intro-step step-1 active" data-target="#avatarDisplayPet">
      
      <p>Hey! I'll be here giving you tips every day! Let me guide you now!</p>
      <button onclick="nextStep()">Next</button>
    </div>

    <!-- Step 2 -->
    <div class="intro-step step-2" data-target="#main-container .top-bar">
      <p>Here you can track your level, your streak, and you can see your experience bar.</p>
      <button onclick="nextStep()">Next</button>
    </div>

    <!-- Step 3 -->
    <div class="intro-step step-3" data-target=".impact">
      <p>Here we calculate your impact.</p>
      <button onclick="nextStep()">Next</button>
    </div>

    <!-- Step 4 -->
    <div class="intro-step step-4" data-target=".buddy-message">
      <p>You can read a new lesson here every day.</p>
      <button onclick="nextStep()">Next</button>
    </div>

    <!-- Step 5 -->
    <div class="intro-step step-5" data-target="#daily-checkin-tab">
      <p>Here you can do your daily lesson, and extend your streak!</p>
      <button onclick="finishIntro()">Finish</button>
    </div>
  </div>
</div>
</div>
</div>

<script>
async function loadPetPhoto() {
  const answers = JSON.parse(localStorage.getItem("veganBuddyAnswers") || "{}");
  const petImg = document.getElementById("petPhotoDisplay");

  // Get logged-in user
  const { data: { user }, error: userError } = await supabase.auth.getUser();
  if (userError || !user) {
    console.error("No user found:", userError);
    return;
  }

  // Fetch profile
  const { data: profile, error: profileError } = await supabase
    .from("profiles")
    .select("pet_photo, pet_name")
    .eq("id", user.id)
    .single();

  if (profileError) {
    console.error("Error fetching profile:", profileError);
  }

  if (profile && profile.pet_photo) {
    petImg.src = profile.pet_photo;
    petImg.alt = profile.pet_name || "Pet";
  } else if (answers.petPhoto) {
    petImg.src = answers.petPhoto;
  } else if (answers.pet) {
    petImg.src = `path/to/pets/${answers.pet}.png`;
  } else {
    petImg.src = "defaultPet.jpg";
  }
}

// Call it once when overlay loads
loadPetPhoto();
</script>

  <script src="mainpagefunctionsscript.js"></script>
  <script type="module" src="mainpagereadscript.js"></script>
  <script type="module" src="mainpagebuttonsscript.js"></script>
</body>
</html>